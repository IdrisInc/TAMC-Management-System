{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Admin Panel{% endblock %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />

    {% block extra_head %}{% endblock %}
</head>
<body x-data="{ sidebarOpen: false }" class="relative h-full">

    <!-- Preloader -->
<div id="preloader" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-white bg-opacity-90 transition-opacity duration-500">
    <img src="{% static 'dist/img/hope.png' %}" alt="Loading" class="h-16 mb-4 animate-pulse" />
    <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-blue-500 border-solid"></div>
</div>

    <div class="min-h-full flex">
        <!-- Sidebar -->
        <aside 
            class="fixed inset-y-0 left-0 z-50 w-72 overflow-y-auto border-r border-gray-200 bg-white px-6 py-8 lg:static lg:translate-x-0 lg:flex-shrink-0"
            :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'"
            x-transition:enter="transition transform duration-300"
            x-transition:enter-start="-translate-x-full"
            x-transition:enter-end="translate-x-0"
            x-transition:leave="transition transform duration-300"
            x-transition:leave-start="translate-x-0"
            x-transition:leave-end="-translate-x-full"
        >
            <div class="flex h-16 shrink-0 items-center justify-between">
                <span class="text-lg font-semibold text-gray-800">Admin Panel</span>
                <!-- Close button (mobile only) -->
                <button @click="sidebarOpen = false" class="lg:hidden text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <nav class="mt-8 space-y-1">
                <!-- Links -->
                <a href="{% url 'staff_user:staff/dashboard' %}" class="group flex items-center rounded-md px-3 py-2 text-sm font-medium 
                    {% if request.resolver_match.url_name == 'dashboard' %}bg-gray-100 text-gray-900
                    {% else %}text-gray-700 hover:bg-gray-50 hover:text-gray-900{% endif %}">
                    <i class="fas fa-tachometer-alt mr-3 text-gray-400 group-hover:text-gray-500"></i>
                    Dashboard
                </a>
                <a href="{% url 'staff_user:registered_users' %}" class="group flex items-center rounded-md px-3 py-2 text-sm font-medium 
                    {% if 'user' in request.resolver_match.url_name %}bg-gray-100 text-gray-900
                    {% else %}text-gray-700 hover:bg-gray-50 hover:text-gray-900{% endif %}">
                    <i class="fas fa-users mr-3 text-gray-400 group-hover:text-gray-500"></i>
                    User Management
                </a>
                <a href="{% url 'finance:financial_dash' %}" class="group flex items-center rounded-md px-3 py-2 text-sm font-medium 
                    {% if 'finance' in request.resolver_match.url_name %}bg-gray-100 text-gray-900
                    {% else %}text-gray-700 hover:bg-gray-50 hover:text-gray-900{% endif %}">
                    <i class="fas fa-wallet mr-3 text-gray-400 group-hover:text-gray-500"></i>
                    Financial
                </a>
                <a href="{% url "equipment:equipment_list" %}" class="group flex items-center rounded-md px-3 py-2 text-sm font-medium 
                    {% if 'equipment' in request.resolver_match.url_name %}bg-gray-100 text-gray-900
                    {% else %}text-gray-700 hover:bg-gray-50 hover:text-gray-900{% endif %}">
                    <i class="fas fa-laptop mr-3 text-gray-400 group-hover:text-gray-500"></i>
                    Equipment Management
                </a>
                <a href="{% url "vacation:vacation" %}" class="group flex items-center rounded-md px-3 py-2 text-sm font-medium 
                    {% if 'leave' in request.resolver_match.url_name %}bg-gray-100 text-gray-900
                    {% else %}text-gray-700 hover:bg-gray-50 hover:text-gray-900{% endif %}">
                    <i class="fas fa-calendar-alt mr-3 text-gray-400 group-hover:text-gray-500"></i>
                    Leave Management
                </a>
                <a href="{% url "equipment:task" %}" class="group flex items-center rounded-md px-3 py-2 text-sm font-medium 
                    {% if 'task' in request.resolver_match.url_name %}bg-gray-100 text-gray-900
                    {% else %}text-gray-700 hover:bg-gray-50 hover:text-gray-900{% endif %}">
                    <i class="fas fa-tasks mr-3 text-gray-400 group-hover:text-gray-500"></i>
                    Task Management
                </a>
            </nav>
        </aside>

        <!-- Overlay -->
        <div 
            x-show="sidebarOpen"
            @click="sidebarOpen = false"
            class="fixed inset-0 z-40 bg-black bg-opacity-25 transition-opacity lg:hidden"
            x-transition:enter="transition ease-out duration-150"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-100"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
        ></div>

        <!-- Main content area -->
        <div class="flex flex-col flex-1 lg:pl-72">
            <!-- Top nav with toggle -->
            <div class="sticky top-0 z-30 bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between lg:justify-end">
                <!-- Toggle button for mobile -->
                <button @click="sidebarOpen = true" class="lg:hidden text-gray-500 hover:text-gray-700">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <div class="text-right">
                    {% include 'base/topnav.html' %}
                </div>
            </div>

            <!-- Main content -->
            <main class="py-10">
                <div class="px-4 sm:px-6 lg:px-8">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>

    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <!-- Preloader Hide Script -->
<script>
const preloader = document.getElementById('preloader');

// Hide preloader on full page load
window.addEventListener('load', () => {
    preloader.classList.add('opacity-0', 'transition-opacity', 'duration-500');
    setTimeout(() => {
        preloader.style.display = 'none';
    }, 500);
});

// Show preloader before HTMX request
let preloaderTimeout;

document.body.addEventListener('htmx:beforeRequest', (evt) => {
    if (evt.detail.target.id === "user-table") {
        preloader.style.display = 'flex';
        preloader.classList.remove('opacity-0');

        // Ensure preloader shows at least 300ms
        preloaderTimeout = setTimeout(() => {}, 300);
    }
});


// Hide preloader after HTMX swaps content
document.body.addEventListener('htmx:afterSwap', (evt) => {
    if (evt.detail.target.id === "user-table") {
        clearTimeout(preloaderTimeout);
        preloader.classList.add('opacity-0');
        setTimeout(() => {
            preloader.style.display = 'none';
        }, 300);
    }
});

</script>


    {% block extra_js %}{% endblock %}
</body>
</html>
